<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta property="og:title" content="Step 5 - Finishing Touches" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://docs.rubato.app/tutorials/platformer/step5.html" />
  <meta property="og:site_name" content="rubato docs" />
  <meta property="og:description" content="This is the final step! We'll be making quality-of-life changes to the game to make it play more like a real platformer. Main Menu: Every good game needs a menu screen. For our platformer, we'll make a new scene for the main menu. Create a new file named main_menu.py. Here's the code needed for i..." />
  <meta property="og:image" content="https://raw.githubusercontent.com/rubatopy/rubato/main/docs/source/_static/full.png" />
  <meta property="og:image:alt" content="rubato docs" />
  <meta property="og:title" content="rubato docs"><link rel="search" title="Search" href="../../../search/" /><link rel="next" title="Best Practices / Usage Guidelines" href="../../usage_guidelines/" /><link rel="prev" title="Step 4 - Creating a Level" href="../step4/" />
        <link rel="canonical" href="https://docs.rubato.app/tutorials/platformer/step5.html" />

    <link rel="shortcut icon" href="https://raw.githubusercontent.com/rubatopy/rubato/main/docs/source/_static/logo_filled.png"/><meta name="generator" content="sphinx-5.1.1, furo 2022.06.21"/>
        <title>Step 5 - Finishing Touches - rubato docs</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=40978830699223671f4072448e654b5958f38b89" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #ff9484;
  --color-brand-content: #ff9484;
  --color-api-name: #ff9484;
  --font-stack: Fredoka, sans-serif;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #ff9484;
  --color-brand-content: #ff9484;
  --color-api-name: #ff9484;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #ff9484;
  --color-brand-content: #ff9484;
  --color-api-name: #ff9484;
  
      }
    }
  }
</style>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WM5S826BXJ"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "G-WM5S826BXJ");
</script>
<script
    src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
    crossorigin="anonymous"
></script>
</head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../"><div class="brand">rubato docs</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><div class="sidebar-scroll"><div id="vtag-name"></div>
<style>
    div#vtag-name {
        color: var(--color-sidebar-caption-text);
        font-size: var(--sidebar-caption-font-size);
        font-weight: 700;
        text-transform: uppercase;
        text-align: right;
        position: relative;
        right: 1.25rem;
        top: 1.75rem;
        margin: -0.25rem 0;
    }
</style>
<script>
    let vtag = document.getElementById("vtag-name");
    function waitForElement() {
        if (typeof window.current !== "undefined") {
            vtag.innerHTML = window.current;
        } else {
            setTimeout(waitForElement, 250);
        }
    }
    waitForElement();
</script>
<a class="sidebar-brand centered" href="https://www.rubato.app">
    
    <div class="sidebar-logo-container">
        <img
            class="sidebar-logo"
            src="https://raw.githubusercontent.com/rubatopy/rubato/main/docs/source/_static/full.png"
            alt="Logo"
            width="240"
            draggable="false"
            style="user-select: none; -moz-user-select: none; -webkit-user-select: none; -webkit-user-drag: none"
        />
    </div>
    
</a><form class="sidebar-search-container" method="get" action="../../../search/" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro/">Getting Started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api/">Full API Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../key-names/">Key Names</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../demos/">Demos</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../">Simple Platformer</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../step1/">Step 1 - Basic Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../step2/">Step 2 - Creating a Player</a></li>
<li class="toctree-l2"><a class="reference internal" href="../step3/">Step 3 - Adding Player Behavior</a></li>
<li class="toctree-l2"><a class="reference internal" href="../step4/">Step 4 - Creating a Level</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Step 5 - Finishing Touches</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../usage_guidelines/">Best Practices / Usage Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced/pyinstaller/">Bundling to an Application</a></li>
</ul>

</div><div id="versionSidebarInclude"></div>
<script>
    if (window.location.hostname == "localhost") {
        console.log("loading test version sidebar from localhost:8001");
        $("#versionSidebarInclude").load("http://localhost:8001/version_sidebar.html");
    } else {
        $("#versionSidebarInclude").load("https://test.rubato.app/version_sidebar.html");
    }
</script></div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          
<div id="topWarning"></div>

<script>
    function genWarning() {
        if (window.current != window.latest && window.current != "latest") {
            div = document.getElementById("topWarning");
            div.classList.add("admonition", "warning");
            let title = document.createElement("p");
            title.classList.add("admonition-title");
            title.innerText = "Warning";

            let content = document.createElement("p");
            if (current == "nightly") {
                content.innerText =
                    "You're reading the documentation for a development version. For the latest released version, ";
            } else {
                content.innerText =
                    "You're reading an old version of this documentation. If you want up-to-date information, ";
            }
            content.innerHTML += `please have a look at <a href='/latest'>${window.latest}</a>.`;

            div.appendChild(title);
            div.appendChild(content);
        }
    }
</script>
<section id="step-5-finishing-touches">
<h1>Step 5 - Finishing Touches<a class="headerlink" href="#step-5-finishing-touches" title="Permalink to this heading">#</a></h1>
<p>This is the final step! We'll be making quality-of-life changes to the game to make it play more like a real platformer.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This step covers general game development concepts that are not unique to rubato (grounding detection, camera scrolling, etc). We will not be going
over how these work, rather we will be focusing on how to implement them in our game. A quick Google search on any of these topics is a great place
to start learning.</p>
</div>
<section id="main-menu">
<h2>Main Menu<a class="headerlink" href="#main-menu" title="Permalink to this heading">#</a></h2>
<p>Every good game needs a menu screen. For our platformer, we'll make a new scene for the main menu. Create a new file
named <code class="code docutils literal notranslate"><span class="pre">main_menu.py</span></code>. Here's the code needed for implementing the basic menu.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">main_menu.py</span><a class="headerlink" href="#id1" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">rubato</span> <span class="k">as</span> <span class="nn">rb</span>
</span><span class="hll"><span class="linenos"> 2</span>
</span><span class="hll"><span class="linenos"> 3</span><span class="n">scene</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span><span class="s2">&quot;main_menu&quot;</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">black</span><span class="p">)</span>  <span class="c1"># make a new scene</span>
</span><span class="hll"><span class="linenos"> 4</span>
</span><span class="hll"><span class="linenos"> 5</span><span class="n">title_font</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">styles</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Font</span><span class="o">.</span><span class="n">BOLD</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>
</span><span class="hll"><span class="linenos"> 6</span><span class="n">title</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;PLATFORMER DEMO!&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">title_font</span><span class="p">)</span>
</span><span class="hll"><span class="linenos"> 7</span>
</span><span class="hll"><span class="linenos"> 8</span><span class="n">play_button</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">GameObject</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">75</span><span class="p">))</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span class="hll"><span class="linenos"> 9</span>    <span class="n">rb</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">10</span>        <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">11</span>        <span class="n">height</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">12</span>        <span class="n">onrelease</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Game</span><span class="o">.</span><span class="n">set_scene</span><span class="p">(</span><span class="s2">&quot;level1&quot;</span><span class="p">),</span>
</span><span class="hll"><span class="linenos">13</span>    <span class="p">),</span>
</span><span class="hll"><span class="linenos">14</span>    <span class="n">rb</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">15</span>        <span class="s2">&quot;PLAY&quot;</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">16</span>        <span class="n">rb</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">white</span><span class="p">),</span>
</span><span class="hll"><span class="linenos">17</span>    <span class="p">),</span>
</span><span class="hll"><span class="linenos">18</span>    <span class="n">r</span> <span class="o">:=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Raster</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">19</span>        <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">20</span>        <span class="n">height</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">21</span>        <span class="n">z_index</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">22</span>    <span class="p">),</span>
</span><span class="hll"><span class="linenos">23</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">24</span><span class="n">r</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">gray</span><span class="o">.</span><span class="n">darker</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
</span><span class="hll"><span class="linenos">25</span>
</span><span class="hll"><span class="linenos">26</span><span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">27</span>    <span class="n">rb</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">75</span><span class="p">)),</span>
</span><span class="hll"><span class="linenos">28</span>    <span class="n">play_button</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">29</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
<p>Also be sure to import and load it in <code class="code docutils literal notranslate"><span class="pre">main.py</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">main.py</span><a class="headerlink" href="#id2" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="linenos">10</span><span class="kn">import</span> <span class="nn">main_menu</span>
</span><span class="linenos">11</span><span class="kn">import</span> <span class="nn">level1</span>
<span class="linenos">12</span>
<span class="hll"><span class="linenos">13</span><span class="n">rb</span><span class="o">.</span><span class="n">Game</span><span class="o">.</span><span class="n">set_scene</span><span class="p">(</span><span class="s2">&quot;main_menu&quot;</span><span class="p">)</span>
</span><span class="linenos">14</span>
<span class="linenos">15</span><span class="c1"># begin the game</span>
<span class="linenos">16</span><span class="n">rb</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>In the menu, we use 4 new classes:
<a class="reference internal" href="../../../api/#rubato.utils.rendering.font.Font" title="rubato.utils.rendering.font.Font"><code class="xref py py-func docutils literal notranslate"><span class="pre">Font</span></code></a>,
<a class="reference internal" href="../../../api/#rubato.structure.gameobject.ui.text.Text" title="rubato.structure.gameobject.ui.text.Text"><code class="xref py py-func docutils literal notranslate"><span class="pre">Text</span></code></a>,
<a class="reference internal" href="../../../api/#rubato.structure.gameobject.ui.button.Button" title="rubato.structure.gameobject.ui.button.Button"><code class="xref py py-func docutils literal notranslate"><span class="pre">Button</span></code></a>, and
<a class="reference internal" href="../../../api/#rubato.structure.gameobject.sprites.raster.Raster" title="rubato.structure.gameobject.sprites.raster.Raster"><code class="xref py py-func docutils literal notranslate"><span class="pre">Raster</span></code></a>.
The behaviors of Font, Text, and Button are fairly trivial.
Raster is a special component in rubato that you can draw custom art to.
In this case, we're using it to draw a background for our button.</p>
</section>
<section id="jump-limit">
<h2>Jump Limit<a class="headerlink" href="#jump-limit" title="Permalink to this heading">#</a></h2>
<p>Right now, when you move around, you'll find that you quickly run out of jumps. This is because we implemented a 2 jump limit. However,
once you run out of jumps, you can't do anything to reset your jump counter. We want this counter to be reset whenever you land on the ground. To do
that, we will add a ground detection hitbox to the player, making sure to set the <code class="docutils literal notranslate"><span class="pre">trigger</span></code> parameter to true.</p>
<p>Making a hitbox a <code class="docutils literal notranslate"><span class="pre">trigger</span></code> prevents the hitbox from resolving collisions in the rubato physics engine. It will still detect overlap
and call the relevant callbacks. We will define a player_collide callback that will be called when the player's ground detector collides.
When this happens, we use the provided collision <a class="reference internal" href="../../../api/#rubato.structure.gameobject.physics.engine.Manifold" title="rubato.structure.gameobject.physics.engine.Manifold"><code class="xref py py-func docutils literal notranslate"><span class="pre">Manifold</span></code></a> to
make sure the other collider is a ground hitbox, that we are not already grounded, and that we are indeed falling towards the ground.
That code looks like this:</p>
<p>In <code class="code docutils literal notranslate"><span class="pre">shared.py</span></code>, add the following code:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">shared.py</span><a class="headerlink" href="#id3" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">16</span><span class="n">player</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">GameObject</span><span class="p">(</span>
<span class="linenos">17</span>    <span class="n">pos</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">center_left</span> <span class="o">+</span> <span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="linenos">18</span>    <span class="n">z_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">19</span><span class="p">)</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="c1"># Create animation and initialize states</span>
<span class="linenos">22</span><span class="n">p_animation</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Spritesheet</span><span class="o">.</span><span class="n">from_folder</span><span class="p">(</span>
<span class="linenos">23</span>    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;files/dino&quot;</span><span class="p">,</span>
<span class="linenos">24</span>    <span class="n">sprite_size</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span>
<span class="linenos">25</span>    <span class="n">default_state</span><span class="o">=</span><span class="s2">&quot;idle&quot;</span><span class="p">,</span>
<span class="linenos">26</span><span class="p">)</span>
<span class="linenos">27</span><span class="n">p_animation</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="linenos">28</span><span class="n">p_animation</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># The frames will change 10 times a second</span>
<span class="linenos">29</span><span class="n">player</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">p_animation</span><span class="p">)</span>  <span class="c1"># Add the animation component to the player</span>
<span class="linenos">30</span>
<span class="hll"><span class="linenos">31</span><span class="n">player</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">32</span>    <span class="c1"># add a hitbox to the player with the collider</span>
</span><span class="hll"><span class="linenos">33</span>    <span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;player&quot;</span><span class="p">),</span>
</span><span class="hll"><span class="linenos">34</span>    <span class="c1"># add a ground detector</span>
</span><span class="hll"><span class="linenos">35</span>    <span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">36</span>        <span class="n">width</span><span class="o">=</span><span class="mi">34</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">37</span>        <span class="n">height</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">38</span>        <span class="n">offset</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">32</span><span class="p">),</span>
</span><span class="hll"><span class="linenos">39</span>        <span class="n">trigger</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">40</span>        <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;player_ground_detector&quot;</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">41</span>    <span class="p">),</span>
</span><span class="hll"><span class="linenos">42</span>    <span class="c1"># add a rigidbody to the player</span>
</span><span class="hll"><span class="linenos">43</span>    <span class="n">rb</span><span class="o">.</span><span class="n">RigidBody</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">44</span>        <span class="n">gravity</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">),</span>
</span><span class="hll"><span class="linenos">45</span>        <span class="n">pos_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">46</span>        <span class="n">friction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">47</span>    <span class="p">),</span>
</span><span class="hll"><span class="linenos">48</span>    <span class="c1"># add custom player component</span>
</span><span class="hll"><span class="linenos">49</span>    <span class="n">player_comp</span> <span class="o">:=</span> <span class="n">PlayerController</span><span class="p">(),</span>
</span><span class="hll"><span class="linenos">50</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
<p>In <code class="code docutils literal notranslate"><span class="pre">player_controller.py</span></code> we get our ground detector and set its on_collide and on_exit callbacks:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">player_controller.py</span><a class="headerlink" href="#id4" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 7</span>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 8</span>        <span class="c1"># Called when added to Game Object.</span>
<span class="linenos"> 9</span>        <span class="c1"># Specifics can be found in the Custom Components tutorial.</span>
<span class="linenos">10</span>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="linenos">11</span>
<span class="linenos">12</span>        <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Animation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Animation</span><span class="p">)</span>
<span class="linenos">13</span>        <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">RigidBody</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">RigidBody</span><span class="p">)</span>
<span class="linenos">14</span>
<span class="hll"><span class="linenos">15</span>        <span class="n">rects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">16</span>        <span class="bp">self</span><span class="o">.</span><span class="n">detector</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rects</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;player_ground_detector&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span class="hll"><span class="linenos">17</span>        <span class="bp">self</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">on_collide</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ground_detect</span>
</span><span class="hll"><span class="linenos">18</span>        <span class="bp">self</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">on_exit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ground_exit</span>
</span><span class="linenos">19</span>
<span class="linenos">20</span>        <span class="c1"># Tracks the number of jumps the player has left</span>
<span class="linenos">21</span>        <span class="bp">self</span><span class="o">.</span><span class="n">jumps</span> <span class="o">=</span> <span class="mi">2</span>
<span class="hll"><span class="linenos">22</span>        <span class="c1"># Tracks the ground state</span>
</span><span class="hll"><span class="linenos">23</span>        <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span> <span class="o">=</span> <span class="kc">False</span>
</span><span class="linenos">24</span>
<span class="linenos">25</span>        <span class="n">rb</span><span class="o">.</span><span class="n">Radio</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Events</span><span class="o">.</span><span class="n">KEYDOWN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_key_down</span><span class="p">)</span>
<span class="linenos">26</span>
<span class="hll"><span class="linenos">27</span>    <span class="k">def</span> <span class="nf">ground_detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_info</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Manifold</span><span class="p">):</span>
</span><span class="hll"><span class="linenos">28</span>        <span class="k">if</span> <span class="s2">&quot;ground&quot;</span> <span class="ow">in</span> <span class="n">col_info</span><span class="o">.</span><span class="n">shape_b</span><span class="o">.</span><span class="n">tag</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">29</span>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">30</span>                <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span> <span class="o">=</span> <span class="kc">True</span>
</span><span class="hll"><span class="linenos">31</span>                <span class="bp">self</span><span class="o">.</span><span class="n">jumps</span> <span class="o">=</span> <span class="mi">2</span>
</span><span class="hll"><span class="linenos">32</span>                <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;idle&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">33</span>
</span><span class="hll"><span class="linenos">34</span>    <span class="k">def</span> <span class="nf">ground_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_info</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Manifold</span><span class="p">):</span>
</span><span class="hll"><span class="linenos">35</span>        <span class="k">if</span> <span class="s2">&quot;ground&quot;</span> <span class="ow">in</span> <span class="n">col_info</span><span class="o">.</span><span class="n">shape_b</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">36</span>            <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span> <span class="o">=</span> <span class="kc">False</span>
</span></pre></div>
</div>
</div>
</section>
<section id="camera-scroll">
<h2>Camera Scroll<a class="headerlink" href="#camera-scroll" title="Permalink to this heading">#</a></h2>
<p>In your testing, you may have also noticed that you are able to walk past the right side of your screen. This is because there is actually more level
space there! Remember that we set our level to be 120% the width of the screen. Lets use rubato's built-in lerp function to make our camera follow the player.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">player_controller.py</span><a class="headerlink" href="#id5" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">38</span>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">39</span>        <span class="c1"># Runs once every frame.</span>
<span class="linenos">40</span>        <span class="c1"># Movement</span>
<span class="linenos">41</span>        <span class="k">if</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">):</span>
<span class="linenos">42</span>            <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">300</span>
<span class="linenos">43</span>            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">flipx</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">44</span>        <span class="k">elif</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">):</span>
<span class="linenos">45</span>            <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">300</span>
<span class="linenos">46</span>            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">flipx</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">47</span>
<span class="hll"><span class="linenos">48</span>    <span class="c1"># define a custom fixed update function</span>
</span><span class="hll"><span class="linenos">49</span>    <span class="k">def</span> <span class="nf">fixed_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll"><span class="linenos">50</span>        <span class="c1"># have the camera follow the player</span>
</span><span class="hll"><span class="linenos">51</span>        <span class="n">current_scene</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Game</span><span class="o">.</span><span class="n">current</span><span class="p">()</span>
</span><span class="hll"><span class="linenos">52</span>        <span class="n">camera_ideal</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Math</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">53</span>            <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">54</span>            <span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">55</span>            <span class="n">shared</span><span class="o">.</span><span class="n">level1_size</span> <span class="o">-</span> <span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">56</span>        <span class="p">)</span>
</span><span class="hll"><span class="linenos">57</span>        <span class="n">current_scene</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Math</span><span class="o">.</span><span class="n">lerp</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">58</span>            <span class="n">current_scene</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">59</span>            <span class="n">camera_ideal</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">60</span>            <span class="n">rb</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">fixed_delta</span> <span class="o">/</span> <span class="mf">0.4</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">61</span>        <span class="p">)</span>
</span></pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">lerp</span></code> and <code class="docutils literal notranslate"><span class="pre">clamp</span></code> are both built-in methods to the <a class="reference internal" href="../../../api/#rubato.utils.computation.rb_math.Math" title="rubato.utils.computation.rb_math.Math"><code class="xref py py-func docutils literal notranslate"><span class="pre">Math</span></code></a> class.
Note that we've used <a class="reference internal" href="../../../api/#rubato.utils.rb_time.Time.fixed_delta" title="rubato.utils.rb_time.Time.fixed_delta"><code class="xref py py-func docutils literal notranslate"><span class="pre">Time.fixed_delta</span></code></a>, which represents the
time elapsed since the last update to the physics engine, in seconds. This is to make our camera follow the player more smoothly,
in line with the fps.</p>
</section>
<section id="final-player-controller-touches">
<h2>Final Player Controller Touches<a class="headerlink" href="#final-player-controller-touches" title="Permalink to this heading">#</a></h2>
<p>We currently only change the animation when the player jumps. Lets add some more animations when the player is moving left and right.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">player_controller.py</span><a class="headerlink" href="#id6" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">38</span>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">39</span>        <span class="c1"># Runs once every frame.</span>
<span class="linenos">40</span>        <span class="c1"># Movement</span>
<span class="linenos">41</span>        <span class="k">if</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">):</span>
<span class="linenos">42</span>            <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">300</span>
<span class="linenos">43</span>            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">flipx</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">44</span>        <span class="k">elif</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">):</span>
<span class="linenos">45</span>            <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">300</span>
<span class="linenos">46</span>            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">flipx</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">47</span>
<span class="hll"><span class="linenos">48</span>        <span class="c1"># Running animation states</span>
</span><span class="hll"><span class="linenos">49</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">50</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="o">-</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">):</span>
</span><span class="hll"><span class="linenos">51</span>                <span class="k">if</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;shift&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>
</span><span class="hll"><span class="linenos">52</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;sneak&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">53</span>                <span class="k">else</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">54</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">55</span>            <span class="k">else</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">56</span>                <span class="k">if</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;shift&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>
</span><span class="hll"><span class="linenos">57</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;crouch&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">58</span>                <span class="k">else</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">59</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;idle&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
<p>Let's also add a reset function. If the player falls off the level or presses the reset key (&quot;r&quot; in this case),
we want to place them back at the start of the level.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">player_controller.py</span><a class="headerlink" href="#id7" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">54</span>        <span class="c1"># Running animation states</span>
<span class="linenos">55</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span><span class="p">:</span>
<span class="linenos">56</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="o">-</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">):</span>
<span class="linenos">57</span>                <span class="k">if</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;shift&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>
<span class="linenos">58</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;sneak&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="linenos">59</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos">60</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="linenos">61</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">62</span>                <span class="k">if</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;shift&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>
<span class="linenos">63</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;crouch&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="linenos">64</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos">65</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;idle&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="linenos">66</span>
<span class="hll"><span class="linenos">67</span>        <span class="c1"># Reset</span>
</span><span class="hll"><span class="linenos">68</span>        <span class="k">if</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">550</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">69</span>            <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_pos</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span class="hll"><span class="linenos">70</span>            <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span class="hll"><span class="linenos">71</span>            <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span> <span class="o">=</span> <span class="kc">False</span>
</span><span class="hll"><span class="linenos">72</span>            <span class="n">rb</span><span class="o">.</span><span class="n">Game</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
<p>Finally, let's add a little bit of polish to the player movement in the form of friction.
This will make the player feel a little more grounded.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">player_controller.py</span><a class="headerlink" href="#id8" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">38</span>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">39</span>        <span class="c1"># Runs once every frame.</span>
<span class="linenos">40</span>        <span class="c1"># Movement</span>
<span class="linenos">41</span>        <span class="k">if</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">):</span>
<span class="linenos">42</span>            <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">300</span>
<span class="linenos">43</span>            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">flipx</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">44</span>        <span class="k">elif</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">):</span>
<span class="linenos">45</span>            <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">300</span>
<span class="linenos">46</span>            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">flipx</span> <span class="o">=</span> <span class="kc">False</span>
<span class="hll"><span class="linenos">47</span>        <span class="k">else</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">48</span>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">49</span>                <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class="hll"><span class="linenos">50</span>                <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">friction</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class="hll"><span class="linenos">51</span>            <span class="k">else</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">52</span>                <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">friction</span> <span class="o">=</span> <span class="mi">1</span>
</span></pre></div>
</div>
</div>
</section>
<section id="to-conclude">
<h2>To Conclude<a class="headerlink" href="#to-conclude" title="Permalink to this heading">#</a></h2>
<p><strong>That's it! You've finished your first platformer in rubato!</strong></p>
<p>This was just the tip of the iceberg of what rubato can do.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
If you got lost, here's the full code, just for kicks:<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">main.py</span><a class="headerlink" href="#id9" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">rubato</span> <span class="k">as</span> <span class="nn">rb</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="c1"># initialize a new game</span>
<span class="linenos"> 4</span><span class="n">rb</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
<span class="linenos"> 5</span>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Platformer Demo&quot;</span><span class="p">,</span>  <span class="c1"># Set a name</span>
<span class="linenos"> 6</span>    <span class="n">res</span><span class="o">=</span><span class="p">(</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">),</span>  <span class="c1"># Set the window resolution (in pixels).</span>
<span class="linenos"> 7</span>    <span class="n">fullscreen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Set the window to be fullscreen</span>
<span class="linenos"> 8</span><span class="p">)</span>
<span class="linenos"> 9</span>
<span class="hll"><span class="linenos">10</span><span class="kn">import</span> <span class="nn">main_menu</span>
</span><span class="linenos">11</span><span class="kn">import</span> <span class="nn">level1</span>
<span class="linenos">12</span>
<span class="hll"><span class="linenos">13</span><span class="n">rb</span><span class="o">.</span><span class="n">Game</span><span class="o">.</span><span class="n">set_scene</span><span class="p">(</span><span class="s2">&quot;main_menu&quot;</span><span class="p">)</span>
</span><span class="linenos">14</span>
<span class="linenos">15</span><span class="c1"># begin the game</span>
<span class="linenos">16</span><span class="n">rb</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">shared.py</span><a class="headerlink" href="#id10" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">rubato</span> <span class="k">as</span> <span class="nn">rb</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">player_controller</span> <span class="kn">import</span> <span class="n">PlayerController</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="c1">##### MISC #####</span>
<span class="linenos"> 5</span><span class="n">level1_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="c1">##### COLORS #####</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="n">platform_color</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">from_hex</span><span class="p">(</span><span class="s2">&quot;#b8e994&quot;</span><span class="p">)</span>
<span class="linenos">10</span><span class="n">background_color</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">from_hex</span><span class="p">(</span><span class="s2">&quot;#82ccdd&quot;</span><span class="p">)</span>
<span class="linenos">11</span><span class="n">win_color</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">green</span><span class="o">.</span><span class="n">darker</span><span class="p">(</span><span class="mi">75</span><span class="p">)</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="c1">##### PLAYER PREFAB #####</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="c1"># Create the player and set its starting position</span>
<span class="linenos">16</span><span class="n">player</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">GameObject</span><span class="p">(</span>
<span class="linenos">17</span>    <span class="n">pos</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">center_left</span> <span class="o">+</span> <span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="linenos">18</span>    <span class="n">z_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">19</span><span class="p">)</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="c1"># Create animation and initialize states</span>
<span class="linenos">22</span><span class="n">p_animation</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Spritesheet</span><span class="o">.</span><span class="n">from_folder</span><span class="p">(</span>
<span class="linenos">23</span>    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;files/dino&quot;</span><span class="p">,</span>
<span class="linenos">24</span>    <span class="n">sprite_size</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span>
<span class="linenos">25</span>    <span class="n">default_state</span><span class="o">=</span><span class="s2">&quot;idle&quot;</span><span class="p">,</span>
<span class="linenos">26</span><span class="p">)</span>
<span class="linenos">27</span><span class="n">p_animation</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="linenos">28</span><span class="n">p_animation</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># The frames will change 10 times a second</span>
<span class="linenos">29</span><span class="n">player</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">p_animation</span><span class="p">)</span>  <span class="c1"># Add the animation component to the player</span>
<span class="linenos">30</span>
<span class="hll"><span class="linenos">31</span><span class="n">player</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">32</span>    <span class="c1"># add a hitbox to the player with the collider</span>
</span><span class="hll"><span class="linenos">33</span>    <span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;player&quot;</span><span class="p">),</span>
</span><span class="hll"><span class="linenos">34</span>    <span class="c1"># add a ground detector</span>
</span><span class="hll"><span class="linenos">35</span>    <span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">36</span>        <span class="n">width</span><span class="o">=</span><span class="mi">34</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">37</span>        <span class="n">height</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">38</span>        <span class="n">offset</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">32</span><span class="p">),</span>
</span><span class="hll"><span class="linenos">39</span>        <span class="n">trigger</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">40</span>        <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;player_ground_detector&quot;</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">41</span>    <span class="p">),</span>
</span><span class="hll"><span class="linenos">42</span>    <span class="c1"># add a rigidbody to the player</span>
</span><span class="hll"><span class="linenos">43</span>    <span class="n">rb</span><span class="o">.</span><span class="n">RigidBody</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">44</span>        <span class="n">gravity</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">),</span>
</span><span class="hll"><span class="linenos">45</span>        <span class="n">pos_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">46</span>        <span class="n">friction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">47</span>    <span class="p">),</span>
</span><span class="hll"><span class="linenos">48</span>    <span class="c1"># add custom player component</span>
</span><span class="hll"><span class="linenos">49</span>    <span class="n">player_comp</span> <span class="o">:=</span> <span class="n">PlayerController</span><span class="p">(),</span>
</span><span class="hll"><span class="linenos">50</span><span class="p">)</span>
</span><span class="linenos">51</span>
<span class="linenos">52</span><span class="c1">##### SIDE BOUDARIES #####</span>
<span class="linenos">53</span>
<span class="linenos">54</span><span class="n">left</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">GameObject</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">center_left</span> <span class="o">-</span> <span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<span class="linenos">55</span>    <span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
<span class="linenos">56</span><span class="p">)</span>
<span class="linenos">57</span><span class="n">right</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">GameObject</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">player_controller.py</span><a class="headerlink" href="#id11" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">rubato</span> <span class="k">as</span> <span class="nn">rb</span>
<span class="hll"><span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">shared</span>
</span><span class="linenos"> 3</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">class</span> <span class="nc">PlayerController</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Component</span><span class="p">):</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 8</span>        <span class="c1"># Called when added to Game Object.</span>
<span class="linenos"> 9</span>        <span class="c1"># Specifics can be found in the Custom Components tutorial.</span>
<span class="linenos">10</span>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="linenos">11</span>
<span class="linenos">12</span>        <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Animation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Animation</span><span class="p">)</span>
<span class="linenos">13</span>        <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">RigidBody</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">RigidBody</span><span class="p">)</span>
<span class="linenos">14</span>
<span class="hll"><span class="linenos">15</span>        <span class="n">rects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">16</span>        <span class="bp">self</span><span class="o">.</span><span class="n">detector</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rects</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;player_ground_detector&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span class="hll"><span class="linenos">17</span>        <span class="bp">self</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">on_collide</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ground_detect</span>
</span><span class="hll"><span class="linenos">18</span>        <span class="bp">self</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">on_exit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ground_exit</span>
</span><span class="linenos">19</span>
<span class="linenos">20</span>        <span class="c1"># Tracks the number of jumps the player has left</span>
<span class="linenos">21</span>        <span class="bp">self</span><span class="o">.</span><span class="n">jumps</span> <span class="o">=</span> <span class="mi">2</span>
<span class="hll"><span class="linenos">22</span>        <span class="c1"># Tracks the ground state</span>
</span><span class="hll"><span class="linenos">23</span>        <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span> <span class="o">=</span> <span class="kc">False</span>
</span><span class="linenos">24</span>
<span class="linenos">25</span>        <span class="n">rb</span><span class="o">.</span><span class="n">Radio</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Events</span><span class="o">.</span><span class="n">KEYDOWN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_key_down</span><span class="p">)</span>
<span class="linenos">26</span>
<span class="hll"><span class="linenos">27</span>    <span class="k">def</span> <span class="nf">ground_detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_info</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Manifold</span><span class="p">):</span>
</span><span class="hll"><span class="linenos">28</span>        <span class="k">if</span> <span class="s2">&quot;ground&quot;</span> <span class="ow">in</span> <span class="n">col_info</span><span class="o">.</span><span class="n">shape_b</span><span class="o">.</span><span class="n">tag</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">29</span>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">30</span>                <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span> <span class="o">=</span> <span class="kc">True</span>
</span><span class="hll"><span class="linenos">31</span>                <span class="bp">self</span><span class="o">.</span><span class="n">jumps</span> <span class="o">=</span> <span class="mi">2</span>
</span><span class="hll"><span class="linenos">32</span>                <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;idle&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">33</span>
</span><span class="hll"><span class="linenos">34</span>    <span class="k">def</span> <span class="nf">ground_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_info</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Manifold</span><span class="p">):</span>
</span><span class="hll"><span class="linenos">35</span>        <span class="k">if</span> <span class="s2">&quot;ground&quot;</span> <span class="ow">in</span> <span class="n">col_info</span><span class="o">.</span><span class="n">shape_b</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">36</span>            <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span> <span class="o">=</span> <span class="kc">False</span>
</span><span class="linenos">37</span>
<span class="linenos">38</span>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">39</span>        <span class="c1"># Runs once every frame.</span>
<span class="linenos">40</span>        <span class="c1"># Movement</span>
<span class="linenos">41</span>        <span class="k">if</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">):</span>
<span class="linenos">42</span>            <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">300</span>
<span class="linenos">43</span>            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">flipx</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">44</span>        <span class="k">elif</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">):</span>
<span class="linenos">45</span>            <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">300</span>
<span class="linenos">46</span>            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">flipx</span> <span class="o">=</span> <span class="kc">False</span>
<span class="hll"><span class="linenos">47</span>        <span class="k">else</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">48</span>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">49</span>                <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class="hll"><span class="linenos">50</span>                <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">friction</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class="hll"><span class="linenos">51</span>            <span class="k">else</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">52</span>                <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">friction</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class="hll"><span class="linenos">53</span>
</span><span class="hll"><span class="linenos">54</span>        <span class="c1"># Running animation states</span>
</span><span class="hll"><span class="linenos">55</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">56</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="o">-</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">):</span>
</span><span class="hll"><span class="linenos">57</span>                <span class="k">if</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;shift&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>
</span><span class="hll"><span class="linenos">58</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;sneak&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">59</span>                <span class="k">else</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">60</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">61</span>            <span class="k">else</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">62</span>                <span class="k">if</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;shift&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>
</span><span class="hll"><span class="linenos">63</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;crouch&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">64</span>                <span class="k">else</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">65</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;idle&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">66</span>
</span><span class="hll"><span class="linenos">67</span>        <span class="c1"># Reset</span>
</span><span class="hll"><span class="linenos">68</span>        <span class="k">if</span> <span class="n">rb</span><span class="o">.</span><span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">550</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">69</span>            <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_pos</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span class="hll"><span class="linenos">70</span>            <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span class="hll"><span class="linenos">71</span>            <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span> <span class="o">=</span> <span class="kc">False</span>
</span><span class="hll"><span class="linenos">72</span>            <span class="n">rb</span><span class="o">.</span><span class="n">Game</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">73</span>
</span><span class="hll"><span class="linenos">74</span>    <span class="c1"># define a custom fixed update function</span>
</span><span class="hll"><span class="linenos">75</span>    <span class="k">def</span> <span class="nf">fixed_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll"><span class="linenos">76</span>        <span class="c1"># have the camera follow the player</span>
</span><span class="hll"><span class="linenos">77</span>        <span class="n">current_scene</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Game</span><span class="o">.</span><span class="n">current</span><span class="p">()</span>
</span><span class="hll"><span class="linenos">78</span>        <span class="n">camera_ideal</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Math</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">79</span>            <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">80</span>            <span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">81</span>            <span class="n">shared</span><span class="o">.</span><span class="n">level1_size</span> <span class="o">-</span> <span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">82</span>        <span class="p">)</span>
</span><span class="hll"><span class="linenos">83</span>        <span class="n">current_scene</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Math</span><span class="o">.</span><span class="n">lerp</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">84</span>            <span class="n">current_scene</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">85</span>            <span class="n">camera_ideal</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">86</span>            <span class="n">rb</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">fixed_delta</span> <span class="o">/</span> <span class="mf">0.4</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">87</span>        <span class="p">)</span>
</span><span class="linenos">88</span>
<span class="linenos">89</span>    <span class="k">def</span> <span class="nf">handle_key_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">KeyResponse</span><span class="p">):</span>
<span class="linenos">90</span>        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;w&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">jumps</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">91</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jumps</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<span class="linenos">92</span>                <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">800</span>
<span class="linenos">93</span>                <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;jump&quot;</span><span class="p">,</span> <span class="n">freeze</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">94</span>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">jumps</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">95</span>                <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">800</span>
<span class="linenos">96</span>                <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;somer&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="linenos">97</span>            <span class="bp">self</span><span class="o">.</span><span class="n">jumps</span> <span class="o">-=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">level1.py</span><a class="headerlink" href="#id12" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">shared</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">rubato</span> <span class="k">as</span> <span class="nn">rb</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="n">scene</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span><span class="s2">&quot;level1&quot;</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">shared</span><span class="o">.</span><span class="n">background_color</span><span class="p">)</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="c1"># create the ground</span>
<span class="linenos"> 7</span><span class="n">ground</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">GameObject</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<span class="linenos"> 8</span>    <span class="n">ground_rect</span> <span class="o">:=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
<span class="linenos"> 9</span>        <span class="n">width</span><span class="o">=</span><span class="mi">1270</span><span class="p">,</span>
<span class="linenos">10</span>        <span class="n">height</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<span class="linenos">11</span>        <span class="n">color</span><span class="o">=</span><span class="n">shared</span><span class="o">.</span><span class="n">platform_color</span><span class="p">,</span>
<span class="linenos">12</span>        <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;ground&quot;</span><span class="p">,</span>
<span class="linenos">13</span>    <span class="p">)</span>
<span class="linenos">14</span><span class="p">)</span>
<span class="linenos">15</span><span class="n">ground_rect</span><span class="o">.</span><span class="n">bottom_left</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">bottom_left</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="n">end_location</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">shared</span><span class="o">.</span><span class="n">level1_size</span> <span class="o">-</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">450</span><span class="p">)</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="c1"># create platforms</span>
<span class="linenos">20</span><span class="n">platforms</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos">21</span>    <span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
<span class="linenos">22</span>        <span class="mi">150</span><span class="p">,</span>
<span class="linenos">23</span>        <span class="mi">40</span><span class="p">,</span>
<span class="linenos">24</span>        <span class="n">offset</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="o">-</span><span class="mi">650</span><span class="p">,</span> <span class="o">-</span><span class="mi">200</span><span class="p">),</span>
<span class="linenos">25</span>    <span class="p">),</span>
<span class="linenos">26</span>    <span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
<span class="linenos">27</span>        <span class="mi">150</span><span class="p">,</span>
<span class="linenos">28</span>        <span class="mi">40</span><span class="p">,</span>
<span class="linenos">29</span>        <span class="n">offset</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span>
<span class="linenos">30</span>    <span class="p">),</span>
<span class="linenos">31</span>    <span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
<span class="linenos">32</span>        <span class="mi">150</span><span class="p">,</span>
<span class="linenos">33</span>        <span class="mi">40</span><span class="p">,</span>
<span class="linenos">34</span>        <span class="n">offset</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
<span class="linenos">35</span>    <span class="p">),</span>
<span class="linenos">36</span>    <span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">end_location</span> <span class="o">-</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span> <span class="o">+</span> <span class="mi">20</span><span class="p">))</span>
<span class="linenos">37</span><span class="p">]</span>
<span class="linenos">38</span>
<span class="linenos">39</span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">platforms</span><span class="p">:</span>
<span class="linenos">40</span>    <span class="n">p</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;ground&quot;</span>
<span class="linenos">41</span>    <span class="n">p</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">shared</span><span class="o">.</span><span class="n">platform_color</span>
<span class="linenos">42</span>
<span class="linenos">43</span><span class="c1"># create pillars</span>
<span class="linenos">44</span><span class="n">pillars</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos">45</span>    <span class="n">rb</span><span class="o">.</span><span class="n">GameObject</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="o">-</span><span class="mi">260</span><span class="p">))</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
<span class="linenos">46</span>        <span class="n">width</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<span class="linenos">47</span>        <span class="n">height</span><span class="o">=</span><span class="mi">650</span><span class="p">,</span>
<span class="linenos">48</span>    <span class="p">)),</span>
<span class="linenos">49</span>    <span class="n">rb</span><span class="o">.</span><span class="n">GameObject</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">260</span><span class="p">))</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
<span class="linenos">50</span>        <span class="n">width</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<span class="linenos">51</span>        <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
<span class="linenos">52</span>    <span class="p">)),</span>
<span class="linenos">53</span><span class="p">]</span>
<span class="linenos">54</span>
<span class="linenos">55</span><span class="k">for</span> <span class="n">pillar</span> <span class="ow">in</span> <span class="n">pillars</span><span class="p">:</span>
<span class="linenos">56</span>    <span class="n">r</span> <span class="o">=</span> <span class="n">pillar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">)</span>
<span class="linenos">57</span>    <span class="n">r</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">bottom</span> <span class="o">+</span> <span class="mi">50</span>
<span class="linenos">58</span>    <span class="n">r</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;ground&quot;</span>
<span class="linenos">59</span>    <span class="n">r</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">shared</span><span class="o">.</span><span class="n">platform_color</span>
<span class="linenos">60</span>
<span class="linenos">61</span><span class="c1"># program the right boundary</span>
<span class="linenos">62</span><span class="n">shared</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">center_left</span> <span class="o">+</span> <span class="p">(</span><span class="n">shared</span><span class="o">.</span><span class="n">level1_size</span> <span class="o">+</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos">63</span>
<span class="linenos">64</span><span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<span class="linenos">65</span>    <span class="n">shared</span><span class="o">.</span><span class="n">player</span><span class="p">,</span>
<span class="linenos">66</span>    <span class="n">ground</span><span class="p">,</span>
<span class="linenos">67</span>    <span class="n">rb</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">platforms</span><span class="p">),</span>
<span class="linenos">68</span>    <span class="o">*</span><span class="n">pillars</span><span class="p">,</span>
<span class="linenos">69</span>    <span class="n">shared</span><span class="o">.</span><span class="n">left</span><span class="p">,</span>
<span class="linenos">70</span>    <span class="n">shared</span><span class="o">.</span><span class="n">right</span><span class="p">,</span>
<span class="linenos">71</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">main_menu.py</span><a class="headerlink" href="#id13" title="Permalink to this code">#</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">rubato</span> <span class="k">as</span> <span class="nn">rb</span>
</span><span class="hll"><span class="linenos"> 2</span>
</span><span class="hll"><span class="linenos"> 3</span><span class="n">scene</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span><span class="s2">&quot;main_menu&quot;</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">black</span><span class="p">)</span>  <span class="c1"># make a new scene</span>
</span><span class="hll"><span class="linenos"> 4</span>
</span><span class="hll"><span class="linenos"> 5</span><span class="n">title_font</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">styles</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Font</span><span class="o">.</span><span class="n">BOLD</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>
</span><span class="hll"><span class="linenos"> 6</span><span class="n">title</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;PLATFORMER DEMO!&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">title_font</span><span class="p">)</span>
</span><span class="hll"><span class="linenos"> 7</span>
</span><span class="hll"><span class="linenos"> 8</span><span class="n">play_button</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">GameObject</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">75</span><span class="p">))</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span class="hll"><span class="linenos"> 9</span>    <span class="n">rb</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">10</span>        <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">11</span>        <span class="n">height</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">12</span>        <span class="n">onrelease</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Game</span><span class="o">.</span><span class="n">set_scene</span><span class="p">(</span><span class="s2">&quot;level1&quot;</span><span class="p">),</span>
</span><span class="hll"><span class="linenos">13</span>    <span class="p">),</span>
</span><span class="hll"><span class="linenos">14</span>    <span class="n">rb</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">15</span>        <span class="s2">&quot;PLAY&quot;</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">16</span>        <span class="n">rb</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">white</span><span class="p">),</span>
</span><span class="hll"><span class="linenos">17</span>    <span class="p">),</span>
</span><span class="hll"><span class="linenos">18</span>    <span class="n">r</span> <span class="o">:=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Raster</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">19</span>        <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">20</span>        <span class="n">height</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">21</span>        <span class="n">z_index</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">22</span>    <span class="p">),</span>
</span><span class="hll"><span class="linenos">23</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">24</span><span class="n">r</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">gray</span><span class="o">.</span><span class="n">darker</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
</span><span class="hll"><span class="linenos">25</span>
</span><span class="hll"><span class="linenos">26</span><span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span class="hll"><span class="linenos">27</span>    <span class="n">rb</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">75</span><span class="p">)),</span>
</span><span class="hll"><span class="linenos">28</span>    <span class="n">play_button</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">29</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
</div>
</details><p>We're also including a version with some more in-depth features that weren't covered in this tutorial, including
win detection, advanced animation switching, and a respawn system. Also new scenes, with multiple levels. Noice.</p>
<p>Sneak Peak:</p>
<a class="reference internal image-reference" href="../../../_images/14.png"><img alt="../../../_images/14.png" class="align-center" src="../../../_images/14.png" style="width: 75%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Here is what that code looks like:<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">This code has new
<a class="reference external" href="https://raw.githubusercontent.com/rubatopy/rubato/main/demo/platformer/files.zip">files</a>.</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">main.py</span><a class="headerlink" href="#id14" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The platformer example tutorial</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">rubato</span> <span class="k">as</span> <span class="nn">rb</span>

<span class="c1"># initialize a new game</span>
<span class="n">rb</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Platformer Demo&quot;</span><span class="p">,</span>  <span class="c1"># Set a name</span>
    <span class="n">res</span><span class="o">=</span><span class="p">(</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">),</span>  <span class="c1"># Increase the window resolution</span>
    <span class="n">fullscreen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Set the window to fullscreen</span>
<span class="p">)</span>

<span class="kn">import</span> <span class="nn">main_menu</span>
<span class="kn">import</span> <span class="nn">level1</span>
<span class="kn">import</span> <span class="nn">level2</span>
<span class="kn">import</span> <span class="nn">end_menu</span>

<span class="n">rb</span><span class="o">.</span><span class="n">Game</span><span class="o">.</span><span class="n">set_scene</span><span class="p">(</span><span class="s2">&quot;main_menu&quot;</span><span class="p">)</span>

<span class="c1"># begin the game</span>
<span class="n">rb</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">level1.py</span><a class="headerlink" href="#id15" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rubato</span> <span class="kn">import</span> <span class="n">Tilemap</span><span class="p">,</span> <span class="n">Display</span><span class="p">,</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">Rectangle</span><span class="p">,</span> <span class="n">wrap</span><span class="p">,</span> <span class="n">Radio</span><span class="p">,</span> <span class="n">Events</span><span class="p">,</span> <span class="n">Game</span><span class="p">,</span> <span class="n">Time</span>
<span class="kn">import</span> <span class="nn">shared</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">shared</span><span class="o">.</span><span class="n">DataScene</span><span class="p">(</span><span class="s2">&quot;level1&quot;</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">shared</span><span class="o">.</span><span class="n">background_color</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">level_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Display</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)</span>

<span class="n">end_location</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">Display</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">scene</span><span class="o">.</span><span class="n">level_size</span> <span class="o">-</span> <span class="mi">128</span><span class="p">,</span> <span class="o">-</span><span class="mi">416</span><span class="p">)</span>

<span class="n">tilemap</span> <span class="o">=</span> <span class="n">Tilemap</span><span class="p">(</span><span class="s2">&quot;files/level1.tmx&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="s2">&quot;ground&quot;</span><span class="p">)</span>
<span class="n">has_won</span> <span class="o">=</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">won</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">click_listener</span><span class="p">,</span> <span class="n">has_won</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_won</span><span class="p">:</span>
        <span class="n">has_won</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">click_listener</span> <span class="o">=</span> <span class="n">Radio</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">Events</span><span class="o">.</span><span class="n">MOUSEUP</span><span class="p">,</span> <span class="n">go_to_next</span><span class="p">)</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">shared</span><span class="o">.</span><span class="n">win_text</span><span class="p">,</span> <span class="n">shared</span><span class="o">.</span><span class="n">win_sub_text</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">go_to_next</span><span class="p">():</span>
    <span class="n">Game</span><span class="o">.</span><span class="n">set_scene</span><span class="p">(</span><span class="s2">&quot;level2&quot;</span><span class="p">)</span>
    <span class="n">click_listener</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">switch</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">has_won</span>
    <span class="n">shared</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">Display</span><span class="o">.</span><span class="n">bottom_left</span> <span class="o">+</span> <span class="n">Vector</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">160</span><span class="p">)</span>
    <span class="n">shared</span><span class="o">.</span><span class="n">player_comp</span><span class="o">.</span><span class="n">initial_pos</span> <span class="o">=</span> <span class="n">shared</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
    <span class="n">shared</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">Display</span><span class="o">.</span><span class="n">center_left</span> <span class="o">+</span> <span class="n">Vector</span><span class="p">(</span><span class="n">scene</span><span class="o">.</span><span class="n">level_size</span> <span class="o">+</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">shared</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">end_location</span>
    <span class="n">shared</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Rectangle</span><span class="p">)</span><span class="o">.</span><span class="n">on_enter</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">col_info</span><span class="p">:</span> <span class="n">won</span><span class="p">()</span> <span class="k">if</span> <span class="n">col_info</span><span class="o">.</span><span class="n">shape_b</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;player&quot;</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">scene</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">shared</span><span class="o">.</span><span class="n">win_text</span><span class="p">,</span> <span class="n">shared</span><span class="o">.</span><span class="n">win_sub_text</span><span class="p">)</span>
    <span class="n">has_won</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">shared</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">Time</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">scene</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="n">scene</span><span class="o">.</span><span class="n">on_switch</span> <span class="o">=</span> <span class="n">switch</span>

<span class="n">shared</span><span class="o">.</span><span class="n">cloud_generator</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wrap</span><span class="p">(</span><span class="n">tilemap</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="n">shared</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">shared</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">shared</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">shared</span><span class="o">.</span><span class="n">flag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">level2.py</span><a class="headerlink" href="#id16" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rubato</span> <span class="kn">import</span> <span class="n">Display</span><span class="p">,</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">Rectangle</span><span class="p">,</span> <span class="n">GameObject</span><span class="p">,</span> <span class="n">Radio</span><span class="p">,</span> <span class="n">Events</span><span class="p">,</span> <span class="n">Game</span><span class="p">,</span> <span class="n">Spritesheet</span><span class="p">,</span> <span class="n">SimpleTilemap</span><span class="p">,</span> <span class="n">Surface</span>
<span class="kn">from</span> <span class="nn">moving_platform</span> <span class="kn">import</span> <span class="n">MovingPlatform</span>
<span class="kn">import</span> <span class="nn">shared</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">shared</span><span class="o">.</span><span class="n">DataScene</span><span class="p">(</span><span class="s2">&quot;level2&quot;</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">shared</span><span class="o">.</span><span class="n">background_color</span><span class="p">)</span>
<span class="n">scene</span><span class="o">.</span><span class="n">level_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Display</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">end_location</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">Display</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">scene</span><span class="o">.</span><span class="n">level_size</span> <span class="o">-</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">tileset</span> <span class="o">=</span> <span class="n">Spritesheet</span><span class="p">(</span><span class="s2">&quot;files/cavesofgallet_tiles.png&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">platforms</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">GameObject</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">Vector</span><span class="p">(</span><span class="o">-</span><span class="mi">885</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">)),</span>
    <span class="n">GameObject</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">Vector</span><span class="p">(</span><span class="o">-</span><span class="mi">735</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">))</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MovingPlatform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
    <span class="n">GameObject</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">Vector</span><span class="p">(</span><span class="o">-</span><span class="mi">185</span><span class="p">,</span> <span class="o">-</span><span class="mi">450</span><span class="p">))</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MovingPlatform</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="mi">980</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
    <span class="n">GameObject</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">))</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MovingPlatform</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
    <span class="n">GameObject</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">Vector</span><span class="p">(</span><span class="mi">1300</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MovingPlatform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
    <span class="n">GameObject</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">Vector</span><span class="p">(</span><span class="mi">1700</span><span class="p">,</span> <span class="o">-</span><span class="mi">400</span><span class="p">))</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MovingPlatform</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
    <span class="n">GameObject</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">Vector</span><span class="p">(</span><span class="mi">2215</span><span class="p">,</span> <span class="mi">100</span><span class="p">)),</span>
    <span class="n">GameObject</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">Vector</span><span class="p">(</span><span class="mi">2730</span><span class="p">,</span> <span class="o">-</span><span class="mi">84</span><span class="p">))</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">Rectangle</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;ground&quot;</span><span class="p">),</span>
        <span class="n">SimpleTilemap</span><span class="p">(</span>
            <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
            <span class="p">[</span><span class="n">tileset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
            <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="n">scale</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">),</span>
<span class="p">]</span>

<span class="n">platform</span> <span class="o">=</span> <span class="n">SimpleTilemap</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">tileset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">scale</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">platforms</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="n">Rectangle</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">r</span> <span class="o">:=</span> <span class="n">Rectangle</span><span class="p">(</span><span class="mi">160</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">MovingPlatform</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">r</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;moving_ground&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;ground&quot;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">clone</span><span class="p">())</span>

<span class="n">shared</span><span class="o">.</span><span class="n">cloud_generator</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">has_won</span> <span class="o">=</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">won</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">click_listener</span><span class="p">,</span> <span class="n">has_won</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_won</span><span class="p">:</span>
        <span class="n">has_won</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">click_listener</span> <span class="o">=</span> <span class="n">Radio</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">Events</span><span class="o">.</span><span class="n">MOUSEUP</span><span class="p">,</span> <span class="n">go_to_next</span><span class="p">)</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">shared</span><span class="o">.</span><span class="n">win_text</span><span class="p">,</span> <span class="n">shared</span><span class="o">.</span><span class="n">win_sub_text</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">go_to_next</span><span class="p">():</span>
    <span class="n">Game</span><span class="o">.</span><span class="n">set_scene</span><span class="p">(</span><span class="s2">&quot;end_menu&quot;</span><span class="p">)</span>
    <span class="n">click_listener</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">switch</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">has_won</span>
    <span class="n">shared</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">Display</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">shared</span><span class="o">.</span><span class="n">player_comp</span><span class="o">.</span><span class="n">initial_pos</span> <span class="o">=</span> <span class="n">shared</span><span class="o">.</span><span class="n">player</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
    <span class="n">shared</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">Display</span><span class="o">.</span><span class="n">center_left</span> <span class="o">+</span> <span class="n">Vector</span><span class="p">(</span><span class="n">scene</span><span class="o">.</span><span class="n">level_size</span> <span class="o">+</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">shared</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">end_location</span>
    <span class="n">shared</span><span class="o">.</span><span class="n">flag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Rectangle</span><span class="p">)</span><span class="o">.</span><span class="n">on_enter</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">col_info</span><span class="p">:</span> <span class="n">won</span><span class="p">()</span> <span class="k">if</span> <span class="n">col_info</span><span class="o">.</span><span class="n">shape_b</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;player&quot;</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">scene</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">shared</span><span class="o">.</span><span class="n">win_text</span><span class="p">,</span> <span class="n">shared</span><span class="o">.</span><span class="n">win_sub_text</span><span class="p">)</span>
    <span class="n">has_won</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">scene</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="n">scene</span><span class="o">.</span><span class="n">on_switch</span> <span class="o">=</span> <span class="n">switch</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">*</span><span class="n">platforms</span><span class="p">,</span> <span class="n">shared</span><span class="o">.</span><span class="n">player</span><span class="p">,</span> <span class="n">shared</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">shared</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">shared</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span> <span class="n">shared</span><span class="o">.</span><span class="n">vignette</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">main_menu.py</span><a class="headerlink" href="#id17" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rubato</span> <span class="kn">import</span> <span class="n">Scene</span><span class="p">,</span> <span class="n">Color</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">wrap</span><span class="p">,</span> <span class="n">Font</span><span class="p">,</span> <span class="n">Game</span>
<span class="kn">import</span> <span class="nn">shared</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">Scene</span><span class="p">(</span><span class="s2">&quot;main_menu&quot;</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">shared</span><span class="o">.</span><span class="n">background_color</span><span class="p">)</span>

<span class="n">title_font</span> <span class="o">=</span> <span class="n">Font</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="n">shared</span><span class="o">.</span><span class="n">font_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">58</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Color</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>
<span class="n">title</span> <span class="o">=</span> <span class="n">Text</span><span class="p">(</span><span class="s2">&quot;Rubato Platformer Demo&quot;</span><span class="p">,</span> <span class="n">title_font</span><span class="p">)</span>

<span class="n">play_button</span> <span class="o">=</span> <span class="n">shared</span><span class="o">.</span><span class="n">smooth_button_generator</span><span class="p">(</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">75</span><span class="p">),</span>
    <span class="mi">300</span><span class="p">,</span>
    <span class="mi">100</span><span class="p">,</span>
    <span class="s2">&quot;PLAY&quot;</span><span class="p">,</span>
    <span class="k">lambda</span><span class="p">:</span> <span class="n">Game</span><span class="o">.</span><span class="n">set_scene</span><span class="p">(</span><span class="s2">&quot;level1&quot;</span><span class="p">),</span>
    <span class="n">Color</span><span class="o">.</span><span class="n">gray</span><span class="o">.</span><span class="n">darker</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wrap</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">75</span><span class="p">)),</span> <span class="n">play_button</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">end_menu.py</span><a class="headerlink" href="#id18" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rubato</span> <span class="kn">import</span> <span class="n">Scene</span><span class="p">,</span> <span class="n">Color</span><span class="p">,</span> <span class="n">Game</span><span class="p">,</span> <span class="n">Display</span><span class="p">,</span> <span class="n">Time</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">GameObject</span>
<span class="kn">import</span> <span class="nn">shared</span><span class="o">,</span> <span class="nn">time</span>

<span class="n">scene</span> <span class="o">=</span> <span class="n">Scene</span><span class="p">(</span><span class="s2">&quot;end_menu&quot;</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">shared</span><span class="o">.</span><span class="n">background_color</span><span class="p">)</span>

<span class="n">restart_button</span> <span class="o">=</span> <span class="n">shared</span><span class="o">.</span><span class="n">smooth_button_generator</span><span class="p">(</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">75</span><span class="p">),</span>
    <span class="mi">600</span><span class="p">,</span>
    <span class="mi">100</span><span class="p">,</span>
    <span class="s2">&quot;RESTART&quot;</span><span class="p">,</span>
    <span class="k">lambda</span><span class="p">:</span> <span class="n">Game</span><span class="o">.</span><span class="n">set_scene</span><span class="p">(</span><span class="s2">&quot;main_menu&quot;</span><span class="p">),</span>
    <span class="n">Color</span><span class="o">.</span><span class="n">gray</span><span class="o">.</span><span class="n">darker</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">screenshot_button</span> <span class="o">=</span> <span class="n">shared</span><span class="o">.</span><span class="n">smooth_button_generator</span><span class="p">(</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">200</span><span class="p">),</span>
    <span class="mi">600</span><span class="p">,</span>
    <span class="mi">100</span><span class="p">,</span>
    <span class="s2">&quot;SAVE SCREENSHOT&quot;</span><span class="p">,</span>
    <span class="k">lambda</span><span class="p">:</span> <span class="n">Display</span><span class="o">.</span><span class="n">save_screenshot</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;platformer time </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)),</span>
    <span class="n">Color</span><span class="o">.</span><span class="n">gray</span><span class="o">.</span><span class="n">darker</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">time_text</span> <span class="o">=</span> <span class="n">GameObject</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Text</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">shared</span><span class="o">.</span><span class="n">white_32</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">on_switch</span><span class="p">():</span>
    <span class="n">final_time</span> <span class="o">=</span> <span class="n">Time</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">shared</span><span class="o">.</span><span class="n">start_time</span>
    <span class="n">time_text</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Text</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Final time: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">final_time</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> seconds&quot;</span>


<span class="n">scene</span><span class="o">.</span><span class="n">on_switch</span> <span class="o">=</span> <span class="n">on_switch</span>
<span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">restart_button</span><span class="p">,</span> <span class="n">screenshot_button</span><span class="p">,</span> <span class="n">time_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">shared.py</span><a class="headerlink" href="#id19" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rubato</span> <span class="k">as</span> <span class="nn">rb</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>


<span class="c1">##### DATA SCENE #####</span>
<span class="k">class</span> <span class="nc">DataScene</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Scene</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level_size</span> <span class="o">=</span> <span class="mi">0</span>


<span class="kn">from</span> <span class="nn">player_controller</span> <span class="kn">import</span> <span class="n">PlayerController</span>

<span class="c1">##### MISC #####</span>

<span class="n">font_name</span> <span class="o">=</span> <span class="s2">&quot;Mozart&quot;</span>
<span class="n">black_32</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="n">font_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
<span class="n">white_32</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="n">font_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1">##### COLORS #####</span>

<span class="n">dirt_color</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">from_hex</span><span class="p">(</span><span class="s2">&quot;#2c3e50&quot;</span><span class="p">)</span>
<span class="n">platform_color</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">from_hex</span><span class="p">(</span><span class="s2">&quot;#2c3e50&quot;</span><span class="p">)</span>
<span class="n">wood_color</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">from_hex</span><span class="p">(</span><span class="s2">&quot;#2c3e50&quot;</span><span class="p">)</span>
<span class="n">background_color</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">from_hex</span><span class="p">(</span><span class="s2">&quot;#21263f&quot;</span><span class="p">)</span>
<span class="n">win_color</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">green</span><span class="o">.</span><span class="n">darker</span><span class="p">(</span><span class="mi">75</span><span class="p">)</span>


<span class="c1">##### FOG EFFECT #####</span>
<span class="k">class</span> <span class="nc">VignetteScroll</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Component</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">player</span><span class="o">.</span><span class="n">pos</span>


<span class="n">vignette</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">GameObject</span><span class="p">(</span><span class="n">z_index</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="s2">&quot;files/vignette/vignette.png&quot;</span><span class="p">),</span> <span class="n">VignetteScroll</span><span class="p">())</span>

<span class="c1">##### PLAYER #####</span>

<span class="c1"># Create the player</span>
<span class="n">player</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">GameObject</span><span class="p">(</span><span class="n">z_index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Create animation and initialize states</span>
<span class="n">p_animation</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Spritesheet</span><span class="o">.</span><span class="n">from_folder</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;files/dino&quot;</span><span class="p">,</span>
    <span class="n">sprite_size</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span>
    <span class="n">default_state</span><span class="o">=</span><span class="s2">&quot;idle&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">p_animation</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">p_animation</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># The frames will change 10 times a second</span>
<span class="n">player</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">p_animation</span><span class="p">)</span>  <span class="c1"># Add the animation component to the player</span>

<span class="n">player</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="c1"># add a hitbox to the player with the collider</span>
    <span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;player&quot;</span><span class="p">),</span>
    <span class="c1"># add a ground detector</span>
    <span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">34</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">offset</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">32</span><span class="p">),</span>
        <span class="n">trigger</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;player_ground_detector&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="c1"># add a rigidbody to the player</span>
    <span class="n">rb</span><span class="o">.</span><span class="n">RigidBody</span><span class="p">(</span><span class="n">gravity</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">),</span> <span class="n">pos_correction</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">friction</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="c1"># add custom player component</span>
    <span class="n">player_comp</span> <span class="o">:=</span> <span class="n">PlayerController</span><span class="p">(),</span>
<span class="p">)</span>

<span class="c1">##### Flag #####</span>

<span class="c1"># Create animation for flag</span>
<span class="n">flag_sheet</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Spritesheet</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;files/flag.png&quot;</span><span class="p">,</span>
    <span class="n">sprite_size</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>
    <span class="n">grid_size</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">flag_animation</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Animation</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">fps</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">flipx</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">flag_animation</span><span class="o">.</span><span class="n">add_spritesheet</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flag_sheet</span><span class="p">,</span> <span class="n">to_coord</span><span class="o">=</span><span class="n">flag_sheet</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>

<span class="c1"># create the end flag</span>
<span class="n">flag</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">GameObject</span><span class="p">()</span>
<span class="n">flag</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">flag_animation</span><span class="p">)</span>

<span class="n">flag</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
        <span class="n">trigger</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;flag&quot;</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=-</span><span class="n">flag_animation</span><span class="o">.</span><span class="n">anim_frame</span><span class="p">()</span><span class="o">.</span><span class="n">size_scaled</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="n">flag_animation</span><span class="o">.</span><span class="n">anim_frame</span><span class="p">()</span><span class="o">.</span><span class="n">size_scaled</span><span class="p">()</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1">##### SIDE BOUDARIES #####</span>
<span class="n">left</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">GameObject</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">center_left</span> <span class="o">-</span> <span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
<span class="n">right</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">GameObject</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>

<span class="c1">##### LEVEL WIN TEXT #####</span>
<span class="n">win_font</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="n">font_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">96</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">win_color</span><span class="p">)</span>
<span class="n">win_text</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">GameObject</span><span class="p">(</span><span class="n">z_index</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">ignore_cam</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s2">&quot;Level Complete!&quot;</span><span class="p">,</span> <span class="n">win_font</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)))</span>
<span class="n">win_sub_text</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">GameObject</span><span class="p">(</span>
    <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">z_index</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
    <span class="n">ignore_cam</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s2">&quot;Click anywhere to move on&quot;</span><span class="p">,</span> <span class="n">white_32</span><span class="p">))</span>


<span class="c1">##### CLOUD #####</span>
<span class="k">class</span> <span class="nc">CloudMover</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Component</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scene</span> <span class="o">:=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Game</span><span class="o">.</span><span class="n">current</span><span class="p">(),</span> <span class="n">DataScene</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1210</span><span class="p">:</span>  <span class="c1"># -960 - 250</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">level_size</span> <span class="o">-</span> <span class="mi">710</span>  <span class="c1"># -960 + 250</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">rb</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">delta_time</span>

    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CloudMover</span><span class="p">()</span>


<span class="n">cloud_template</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">GameObject</span><span class="p">(</span><span class="n">z_index</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="s2">&quot;files/cloud.png&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span> <span class="n">CloudMover</span><span class="p">())</span>
<span class="n">cloud_template</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">170</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">cloud_generator</span><span class="p">(</span><span class="n">scene</span><span class="p">:</span> <span class="n">DataScene</span><span class="p">,</span> <span class="n">num_clouds</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">top_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="n">half_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">half_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rb</span><span class="o">.</span><span class="n">Display</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_clouds</span><span class="p">):</span>
        <span class="n">rand_pos</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span>
            <span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="n">half_width</span><span class="p">,</span> <span class="n">scene</span><span class="o">.</span><span class="n">level_size</span> <span class="o">-</span> <span class="n">half_width</span><span class="p">),</span>
            <span class="n">randint</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">top_only</span> <span class="k">else</span> <span class="o">-</span><span class="n">half_height</span><span class="p">,</span> <span class="n">half_height</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">cloud</span> <span class="o">=</span> <span class="n">cloud_template</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">rand_pos</span>

        <span class="n">scene</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>


<span class="c1">##### NICE BUTTON #####</span>
<span class="k">def</span> <span class="nf">smooth_button_generator</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">onrelease</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">white_32</span><span class="o">.</span><span class="n">clone</span><span class="p">())</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Raster</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">z_index</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">rb</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
        <span class="n">w</span><span class="p">,</span>
        <span class="n">h</span><span class="p">,</span>
        <span class="n">onhover</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">recurrent_call</span><span class="p">(</span><span class="n">increase_font_size</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">),</span>
        <span class="n">onexit</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">recurrent_call</span><span class="p">(</span><span class="n">decrease_font_size</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">),</span>
        <span class="n">onrelease</span><span class="o">=</span><span class="n">onrelease</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">font_changing</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">RecurrentTask</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">increase_font_size</span><span class="p">(</span><span class="n">task</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">RecurrentTask</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">font_changing</span>
        <span class="k">if</span> <span class="n">font_changing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">font_changing</span> <span class="o">!=</span> <span class="n">task</span><span class="p">:</span>
            <span class="n">font_changing</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="n">t</span><span class="o">.</span><span class="n">font_object</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">font_object</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="mi">64</span><span class="p">:</span>
            <span class="n">task</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="n">font_changing</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">t</span><span class="o">.</span><span class="n">font_object</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">64</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">font_changing</span> <span class="o">=</span> <span class="n">task</span>

    <span class="k">def</span> <span class="nf">decrease_font_size</span><span class="p">(</span><span class="n">task</span><span class="p">:</span> <span class="n">rb</span><span class="o">.</span><span class="n">RecurrentTask</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">font_changing</span>
        <span class="k">if</span> <span class="n">font_changing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">font_changing</span> <span class="o">!=</span> <span class="n">task</span><span class="p">:</span>
            <span class="n">font_changing</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="n">t</span><span class="o">.</span><span class="n">font_object</span><span class="o">.</span><span class="n">size</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">font_object</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">32</span><span class="p">:</span>
            <span class="n">task</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="n">font_changing</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">t</span><span class="o">.</span><span class="n">font_object</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">32</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">font_changing</span> <span class="o">=</span> <span class="n">task</span>

    <span class="k">return</span> <span class="n">rb</span><span class="o">.</span><span class="n">GameObject</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">player_controller.py</span><a class="headerlink" href="#id20" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rubato</span> <span class="kn">import</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Animation</span><span class="p">,</span> <span class="n">RigidBody</span><span class="p">,</span> <span class="n">Rectangle</span><span class="p">,</span> <span class="n">Manifold</span><span class="p">,</span> <span class="n">Radio</span><span class="p">,</span> <span class="n">Events</span><span class="p">,</span> <span class="n">KeyResponse</span><span class="p">,</span> <span class="n">JoyButtonResponse</span> \
    <span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Math</span><span class="p">,</span> <span class="n">Display</span><span class="p">,</span> <span class="n">Game</span><span class="p">,</span> <span class="n">Time</span><span class="p">,</span> <span class="n">Vector</span>
<span class="kn">from</span> <span class="nn">shared</span> <span class="kn">import</span> <span class="n">DataScene</span>


<span class="k">class</span> <span class="nc">PlayerController</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="p">:</span> <span class="n">Animation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Animation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="p">:</span> <span class="n">RigidBody</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">RigidBody</span><span class="p">)</span>

        <span class="n">rects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="n">Rectangle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ground_detector</span><span class="p">:</span> <span class="n">Rectangle</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rects</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;player_ground_detector&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ground_detector</span><span class="o">.</span><span class="n">on_collide</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ground_detect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ground_detector</span><span class="o">.</span><span class="n">on_exit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ground_exit</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># tracks the ground state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jumps</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># tracks the number of jumps the player has left</span>

        <span class="n">Radio</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">Events</span><span class="o">.</span><span class="n">KEYDOWN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_key_down</span><span class="p">)</span>
        <span class="n">Radio</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">Events</span><span class="o">.</span><span class="n">JOYBUTTONDOWN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_controller_button</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ground_detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_info</span><span class="p">:</span> <span class="n">Manifold</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;ground&quot;</span> <span class="ow">in</span> <span class="n">col_info</span><span class="o">.</span><span class="n">shape_b</span><span class="o">.</span><span class="n">tag</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">jumps</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;idle&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ground_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_info</span><span class="p">:</span> <span class="n">Manifold</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;ground&quot;</span> <span class="ow">in</span> <span class="n">col_info</span><span class="o">.</span><span class="n">shape_b</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">handle_key_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">KeyResponse</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;w&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">jumps</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jumps</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">800</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;jump&quot;</span><span class="p">,</span> <span class="n">freeze</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">jumps</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">800</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;somer&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jumps</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">handle_controller_button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">JoyButtonResponse</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># xbox a button / sony x button</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_key_down</span><span class="p">(</span><span class="n">KeyResponse</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">move_axis</span> <span class="o">=</span> <span class="n">Input</span><span class="o">.</span><span class="n">controller_axis</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">Input</span><span class="o">.</span><span class="n">controllers</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">centered</span> <span class="o">=</span> <span class="n">Input</span><span class="o">.</span><span class="n">axis_centered</span><span class="p">(</span><span class="n">move_axis</span><span class="p">)</span>
        <span class="c1"># Movement</span>
        <span class="k">if</span> <span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">move_axis</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">centered</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">300</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">flipx</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">move_axis</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">centered</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">300</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">flipx</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">friction</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">friction</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Running animation states</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="o">-</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;shift&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;sneak&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;shift&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;crouch&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;idle&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Reset</span>
        <span class="k">if</span> <span class="n">Input</span><span class="o">.</span><span class="n">key_pressed</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">Input</span><span class="o">.</span><span class="n">controller_button</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="k">if</span> <span class="n">Input</span><span class="o">.</span><span class="n">controllers</span><span class="p">()</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">550</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;idle&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_pos</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grounded</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">Game</span><span class="o">.</span><span class="n">current</span><span class="p">()</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># define a custom fixed update function</span>
    <span class="k">def</span> <span class="nf">fixed_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># have the camera follow the player</span>
        <span class="n">current_scene</span> <span class="o">=</span> <span class="n">Game</span><span class="o">.</span><span class="n">current</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_scene</span><span class="p">,</span> <span class="n">DataScene</span><span class="p">):</span>
            <span class="n">camera_ideal</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">Display</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="n">Display</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">current_scene</span><span class="o">.</span><span class="n">level_size</span> <span class="o">-</span> <span class="n">Display</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">x</span>
            <span class="p">)</span>
            <span class="n">current_scene</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">lerp</span><span class="p">(</span><span class="n">current_scene</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">camera_ideal</span><span class="p">,</span> <span class="n">Time</span><span class="o">.</span><span class="n">fixed_delta</span> <span class="o">/</span> <span class="mf">0.4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">moving_platform.py</span><a class="headerlink" href="#id21" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rubato</span> <span class="kn">import</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Time</span><span class="p">,</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">Rectangle</span><span class="p">,</span> <span class="n">Manifold</span>


<span class="k">class</span> <span class="nc">MovingPlatform</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">bound</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="n">speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">direction_vect</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">direction_vect</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;u&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">direction_vect</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">direction_vect</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bound</span> <span class="o">=</span> <span class="n">bound</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pause</span> <span class="o">=</span> <span class="n">pause</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pause_counter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hitbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Rectangle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hitbox</span><span class="o">.</span><span class="n">on_collide</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collision_detect</span>

    <span class="k">def</span> <span class="nf">collision_detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_info</span><span class="p">:</span> <span class="n">Manifold</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">col_info</span><span class="o">.</span><span class="n">shape_b</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;player&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pause_counter</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">col_info</span><span class="o">.</span><span class="n">shape_b</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction_vect</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*</span> <span class="n">Time</span><span class="o">.</span><span class="n">fixed_delta</span>

    <span class="k">def</span> <span class="nf">fixed_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pause_counter</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pause_counter</span> <span class="o">-=</span> <span class="n">Time</span><span class="o">.</span><span class="n">fixed_delta</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction_vect</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*</span> <span class="n">Time</span><span class="o">.</span><span class="n">fixed_delta</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">old_dir_vect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction_vect</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_pos</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bound</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">direction_vect</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_pos</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">direction_vect</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_pos</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">bound</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">direction_vect</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_pos</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">direction_vect</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;u&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_pos</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bound</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">direction_vect</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_pos</span><span class="o">.</span><span class="n">y</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">direction_vect</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_pos</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">bound</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">direction_vect</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gameobj</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_pos</span><span class="o">.</span><span class="n">y</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">direction_vect</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_dir_vect</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction_vect</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pause_counter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pause</span>
</pre></div>
</div>
</div>
</div>
</details><p>We hope this tutorial gave enough detail as to the basics of rubato to let you make your own games and simulations!
If you have questions or feedback, please feel free to contact us on our <a class="reference external" href="https://discord.gg/rdce5GXRrC">Discord server</a> or by <a class="reference external" href="mailto:info&#37;&#52;&#48;rubato&#46;app">sending us an email</a>!</p>
</section>
</section>
 
        </article>
      </div>
      <footer>
        
<div class="related-pages">
    <a class="next-page" href="../../usage_guidelines/">
        <div class="page-info">
            <div class="context">
                <span>Next</span>
            </div>
            <div class="title">Best Practices / Usage Guidelines</div>
        </div>
        <svg><use href="#svg-arrow-right"></use></svg>
    </a> <a class="prev-page" href="../step4/">
        <svg><use href="#svg-arrow-right"></use></svg>
        <div class="page-info">
            <div class="context">
                <span>Previous</span>
            </div>
            
            <div class="title">Step 4 - Creating a Level</div>
            
        </div>
    </a>
</div>
<div class="bottom-of-page">
    <div class="left-details">
        <div class="copyright"> Copyright &#169; 2022, Martin Chaperot, Tomer Sedan, Yamm Elnekave
        </div>
    </div>
    <div class="right-details">
        <div class="icons"><a class="muted-link" href="https://github.com/rubatopy/rubato" aria-label="On GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path
                        fill-rule="evenodd"
                        d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"
                    ></path>
                </svg>
            </a>
        </div>
    </div>
</div>

      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Step 5 - Finishing Touches</a><ul>
<li><a class="reference internal" href="#main-menu">Main Menu</a></li>
<li><a class="reference internal" href="#jump-limit">Jump Limit</a></li>
<li><a class="reference internal" href="#camera-scroll">Camera Scroll</a></li>
<li><a class="reference internal" href="#final-player-controller-touches">Final Player Controller Touches</a></li>
<li><a class="reference internal" href="#to-conclude">To Conclude</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/tabs.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    </body>
</html>